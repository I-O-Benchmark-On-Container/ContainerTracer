import os

Import("env")

CURRENT_PROJECT = "trace-replay"

current_env = env.Clone()

current_env.Append(
    CFLAGS=["-D_LARGEFILE_SOURCE", "-D_FILE_OFFSET_BITS=64", "-D_GNU_SOURCE"]
)
current_env.Append(CPPPATH=[env["INCLUDE_LOCATION"]])
current_env.Append(LDFLAGS=["-lpthread", "-laio", "-lrt"])
current_env.Append(LIBS=["aio", "rt", "pthread"])

current_env.Program(
    target=env["PROGRAM_LOCATION"] + "/" + CURRENT_PROJECT, source=Glob("*.c")
)

shared_env = current_env.Clone()
shared_env.Append(CFLAGS=["-DUNIT_TEST"])

shared_env.SharedLibrary(
    target=env["PROGRAM_LOCATION"] + "/" + CURRENT_PROJECT + ".so", source=Glob("*.c")
)

if current_env["BUILD_UNIT_TEST"] == True:
    SConscript("test/SConscript")
